"use strict";(self["webpackChunkmy_vue2_project"]=self["webpackChunkmy_vue2_project"]||[]).push([[991],{1552:function(e,t,s){s.d(t,{_z:function(){return l},iD:function(){return o},lj:function(){return i}});var r=s(4373);const a="https://111dc5664cn09.vicp.fun/api",n=r.A.create({baseURL:a,timeout:5e3}),o=(e,t)=>n.post("/login",{username:e,password:t}),i=()=>n.get("/chat/messages"),l=e=>n.post("/chat/messages",e)},8991:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"text-align":"center","margin-top":"60px"}},[e.user.avatar_url?t("img",{staticStyle:{"border-radius":"50%"},attrs:{src:e.user.avatar_url,width:"80",height:"80"}}):e._e(),t("h2",[e._v("欢迎，"+e._s(e.user.username)+"!")]),t("p",[e._v("邮箱："+e._s(e.user.email||"暂无"))]),t("p",[e._v("注册时间："+e._s(e.user.created_at||"未知"))]),t("button",{on:{click:e.logout}},[e._v("退出登录")]),t("button",{staticStyle:{margin:"8px"},on:{click:e.loadMessages}},[e._v("刷新消息")]),t("div",{staticStyle:{"max-width":"500px",margin:"40px auto"}},[t("div",{ref:"msgBox",staticStyle:{height:"260px",border:"1px solid #ccc","border-radius":"6px",padding:"8px","overflow-y":"auto",background:"#fafafa","text-align":"left"}},e._l(e.messages,function(s){return t("div",{key:s.id,staticStyle:{margin:"4px 0"}},[t("b",[e._v(e._s(s.username))]),e._v(" "),t("small",{staticStyle:{color:"#888"}},[e._v(e._s(s.created_at))]),t("br"),e._v(" "+e._s(s.content+"喵~")+" ")])}),0),t("div",{staticStyle:{display:"flex","margin-top":"8px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newMsg,expression:"newMsg"}],staticStyle:{flex:"1",padding:"6px 8px",border:"1px solid #ccc","border-radius":"4px"},attrs:{placeholder:"说点什么..."},domProps:{value:e.newMsg},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMsg.apply(null,arguments)},input:function(t){t.target.composing||(e.newMsg=t.target.value)}}}),t("button",{staticStyle:{"margin-left":"6px",padding:"6px 12px"},on:{click:e.sendMsg}},[e._v("发送")])])])])},a=[],n=s(1552),o={name:"HomePage",data(){return{user:JSON.parse(localStorage.getItem("user")||"{}"),messages:[],newMsg:"",timer:null,autoRefresh:!1}},created(){this.loadMessages(),this.autoRefresh&&(this.timer=setInterval(this.loadMessages,6e3))},beforeDestroy(){clearInterval(this.timer)},methods:{logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.$router.replace("/login")},loadMessages(){(0,n.lj)().then(e=>{0===e.data.code&&(this.messages=e.data.data,this.$nextTick(()=>{const e=this.$refs.msgBox;e&&(e.scrollTop=e.scrollHeight)}))}).catch(console.error)},sendMsg(){const e=this.newMsg.trim();if(!e)return;const t={user_id:this.user.id||1,username:this.user.username,content:e};(0,n._z)(t).then(e=>{if(0===e.data.code)return this.loadMessages();throw new Error(e.data.message)}).catch(console.error).finally(()=>{this.newMsg=""})}}},i=o,l=s(1656),c=(0,l.A)(i,r,a,!1,null,null,null),u=c.exports}}]);
//# sourceMappingURL=991.c293282b.js.map