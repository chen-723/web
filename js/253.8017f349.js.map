{"version":3,"file":"js/253.8017f349.js","mappings":"yKAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,CAAC,aAAa,SAAS,aAAa,SAAS,CAAEJ,EAAIK,KAAKC,WAAYJ,EAAG,MAAM,CAACE,YAAY,CAAC,gBAAgB,OAAOG,MAAM,CAAC,IAAMP,EAAIK,KAAKC,WAAW,MAAQ,KAAK,OAAS,QAAQN,EAAIQ,KAAKN,EAAG,KAAK,CAACF,EAAIS,GAAG,MAAMT,EAAIU,GAAGV,EAAIK,KAAKM,UAAU,OAAOT,EAAG,IAAI,CAACF,EAAIS,GAAG,MAAMT,EAAIU,GAAGV,EAAIK,KAAKO,OAAS,SAASV,EAAG,IAAI,CAACF,EAAIS,GAAG,QAAQT,EAAIU,GAAGV,EAAIK,KAAKQ,YAAc,SAASX,EAAG,SAAS,CAACY,GAAG,CAAC,MAAQd,EAAIe,SAAS,CAACf,EAAIS,GAAG,UAAUP,EAAG,SAAS,CAACE,YAAY,CAAC,OAAS,OAAOU,GAAG,CAAC,MAAQd,EAAIgB,eAAe,CAAChB,EAAIS,GAAG,UAAUP,EAAG,MAAM,CAACE,YAAY,CAAC,YAAY,QAAQ,OAAS,cAAc,CAACF,EAAG,MAAM,CAACe,IAAI,SAASb,YAAY,CAAC,OAAS,QAAQ,OAAS,iBAAiB,gBAAgB,MAAM,QAAU,MAAM,aAAa,OAAO,WAAa,UAAU,aAAa,SAASJ,EAAIkB,GAAIlB,EAAImB,SAAU,SAASC,GAAG,OAAOlB,EAAG,MAAM,CAACmB,IAAID,EAAEE,GAAGlB,YAAY,CAAC,OAAS,UAAU,CAACF,EAAG,IAAI,CAACF,EAAIS,GAAGT,EAAIU,GAAGU,EAAET,aAAaX,EAAIS,GAAG,KAAKP,EAAG,QAAQ,CAACE,YAAY,CAAC,MAAQ,SAAS,CAACJ,EAAIS,GAAGT,EAAIU,GAAGU,EAAEP,eAAeX,EAAG,MAAMF,EAAIS,GAAG,IAAIT,EAAIU,GAAGU,EAAEG,QAAS,MAAM,MAAM,GAAG,GAAGrB,EAAG,MAAM,CAACE,YAAY,CAAC,QAAU,OAAO,aAAa,QAAQ,CAACF,EAAG,QAAQ,CAACsB,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAO3B,EAAI4B,OAAQC,WAAW,WAAWzB,YAAY,CAAC,KAAO,IAAI,QAAU,UAAU,OAAS,iBAAiB,gBAAgB,OAAOG,MAAM,CAAC,YAAc,WAAWuB,SAAS,CAAC,MAAS9B,EAAI4B,QAASd,GAAG,CAAC,MAAQ,SAASiB,GAAQ,OAAIA,EAAOC,KAAKC,QAAQ,QAAQjC,EAAIkC,GAAGH,EAAOI,QAAQ,QAAQ,GAAGJ,EAAOV,IAAI,SAAgB,KAAYrB,EAAIoC,QAAQC,MAAM,KAAMC,UAAU,EAAE,MAAQ,SAASP,GAAWA,EAAOQ,OAAOC,YAAiBxC,EAAI4B,OAAOG,EAAOQ,OAAOZ,MAAK,KAAKzB,EAAG,SAAS,CAACE,YAAY,CAAC,cAAc,MAAM,QAAU,YAAYU,GAAG,CAAC,MAAQd,EAAIoC,UAAU,CAACpC,EAAIS,GAAG,aACpwD,EACIgC,EAAkB,G,UCsCtB,GACAhB,KAAA,WACAiB,IAAAA,GACA,OACArC,KAAAsC,KAAAC,MAAAC,aAAAC,QAAA,eACA3B,SAAA,GACAS,OAAA,GACAmB,MAAA,KACAC,aAAA,EAEA,EACAC,OAAAA,GAEA,KAAAjC,eACA,KAAAgC,cACA,KAAAD,MAAAG,YAAA,KAAAlC,aAAA,KAEA,EACAmC,aAAAA,GAEAC,cAAA,KAAAL,MACA,EACAM,QAAA,CACAtC,MAAAA,GACA8B,aAAAS,WAAA,SACAT,aAAAS,WAAA,QACA,KAAAC,QAAAC,QAAA,SACA,EAEAxC,YAAAA,IACAyC,EAAAA,EAAAA,MACAC,KAAAC,IACA,IAAAA,EAAAjB,KAAAkB,OACA,KAAAzC,SAAAwC,EAAAjB,KAAAA,KAEA,KAAAmB,UAAA,KACA,MAAAC,EAAA,KAAAC,MAAAC,OACAF,IAAAA,EAAAG,UAAAH,EAAAI,mBAIAC,MAAAC,QAAAC,MACA,EACAjC,OAAAA,GACA,MAAAb,EAAA,KAAAK,OAAA0C,OACA,IAAA/C,EAAA,OAEA,MAAAgD,EAAA,CACAC,QAAA,KAAAnE,KAAAiB,IAAA,EACAX,SAAA,KAAAN,KAAAM,SACAY,YAGAkD,EAAAA,EAAAA,IAAAF,GACAb,KAAAC,IACA,OAAAA,EAAAjB,KAAAkB,KAEA,YAAA5C,eAEA,UAAA0D,MAAAf,EAAAjB,KAAAiC,WAEAR,MAAAC,QAAAC,OACAO,QAAA,KACA,KAAAhD,OAAA,IAEA,ICzGuP,I,UCOnPiD,GAAY,OACd,EACA9E,EACA0C,GACA,EACA,KACA,KACA,MAIF,EAAeoC,E,6HCff,MAAMC,EAAU,qCAEVC,EAAMC,EAAAA,EAAMC,OAAO,CACvBH,UACAI,QAAS,MAGEC,EAAQA,CAACxE,EAAUyE,IAC9BL,EAAIM,KAAK,SAAU,CAAE1E,WAAUyE,aAGpB3B,EAAgBA,IAAMsB,EAAIO,IAAI,kBAG9Bb,EAAeF,GAC1BQ,EAAIM,KAAK,iBAAkBd,E","sources":["webpack://my-vue2-project/./src/views/HomePage.vue","webpack://my-vue2-project/src/views/HomePage.vue","webpack://my-vue2-project/./src/views/HomePage.vue?92db","webpack://my-vue2-project/./src/views/HomePage.vue?406d","webpack://my-vue2-project/./src/api/index.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticStyle:{\"text-align\":\"center\",\"margin-top\":\"60px\"}},[(_vm.user.avatar_url)?_c('img',{staticStyle:{\"border-radius\":\"50%\"},attrs:{\"src\":_vm.user.avatar_url,\"width\":\"80\",\"height\":\"80\"}}):_vm._e(),_c('h2',[_vm._v(\"欢迎，\"+_vm._s(_vm.user.username)+\"!\")]),_c('p',[_vm._v(\"邮箱：\"+_vm._s(_vm.user.email || '暂无'))]),_c('p',[_vm._v(\"注册时间：\"+_vm._s(_vm.user.created_at || '未知'))]),_c('button',{on:{\"click\":_vm.logout}},[_vm._v(\"退出登录\")]),_c('button',{staticStyle:{\"margin\":\"8px\"},on:{\"click\":_vm.loadMessages}},[_vm._v(\"刷新消息\")]),_c('div',{staticStyle:{\"max-width\":\"500px\",\"margin\":\"40px auto\"}},[_c('div',{ref:\"msgBox\",staticStyle:{\"height\":\"260px\",\"border\":\"1px solid #ccc\",\"border-radius\":\"6px\",\"padding\":\"8px\",\"overflow-y\":\"auto\",\"background\":\"#fafafa\",\"text-align\":\"left\"}},_vm._l((_vm.messages),function(m){return _c('div',{key:m.id,staticStyle:{\"margin\":\"4px 0\"}},[_c('b',[_vm._v(_vm._s(m.username))]),_vm._v(\" \"),_c('small',{staticStyle:{\"color\":\"#888\"}},[_vm._v(_vm._s(m.created_at))]),_c('br'),_vm._v(\" \"+_vm._s(m.content +'喵~')+\" \")])}),0),_c('div',{staticStyle:{\"display\":\"flex\",\"margin-top\":\"8px\"}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.newMsg),expression:\"newMsg\"}],staticStyle:{\"flex\":\"1\",\"padding\":\"6px 8px\",\"border\":\"1px solid #ccc\",\"border-radius\":\"4px\"},attrs:{\"placeholder\":\"说点什么...\"},domProps:{\"value\":(_vm.newMsg)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\"))return null;return _vm.sendMsg.apply(null, arguments)},\"input\":function($event){if($event.target.composing)return;_vm.newMsg=$event.target.value}}}),_c('button',{staticStyle:{\"margin-left\":\"6px\",\"padding\":\"6px 12px\"},on:{\"click\":_vm.sendMsg}},[_vm._v(\"发送\")])])])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div style=\"text-align:center;margin-top:60px;\">\r\n    <!-- 1. 原用户信息 -->\r\n    <img v-if=\"user.avatar_url\" :src=\"user.avatar_url\" width=\"80\" height=\"80\" style=\"border-radius:50%;\" />\r\n    <h2>欢迎，{{ user.username }}!</h2>\r\n    <p>邮箱：{{ user.email || '暂无' }}</p>\r\n    <p>注册时间：{{ user.created_at || '未知' }}</p>\r\n    <button @click=\"logout\">退出登录</button>\r\n    <button @click=\"loadMessages\" style=\"margin:8px;\">刷新消息</button>\r\n\r\n    <!-- 2. 聊天区域 -->\r\n    <div style=\"max-width:500px;margin:40px auto;\">\r\n      <!-- 消息列表 -->\r\n      <div\r\n        ref=\"msgBox\"\r\n        style=\"height:260px;border:1px solid #ccc;border-radius:6px;padding:8px;overflow-y:auto;background:#fafafa;text-align:left;\"\r\n      >\r\n        <div v-for=\"m in messages\" :key=\"m.id\" style=\"margin:4px 0;\">\r\n          <b>{{ m.username }}</b> <small style=\"color:#888;\">{{ m.created_at }}</small><br/>\r\n          {{ m.content +'喵~' }}\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 输入+发送 -->\r\n      <div style=\"display:flex;margin-top:8px;\">\r\n        <input\r\n          v-model=\"newMsg\"\r\n          @keyup.enter=\"sendMsg\"\r\n          style=\"flex:1;padding:6px 8px;border:1px solid #ccc;border-radius:4px;\"\r\n          placeholder=\"说点什么...\"\r\n        />\r\n        <button @click=\"sendMsg\" style=\"margin-left:6px;padding:6px 12px;\">发送</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { fetchMessages, sendMessage } from '@/api/index.js'\r\n\r\nexport default {\r\n  name: 'HomePage',\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem('user') || '{}'),\r\n      messages: [],\r\n      newMsg: '',\r\n      timer: null,\r\n       autoRefresh: true   // true 开启，false 关闭\r\n    }\r\n  },\r\n  created() {\r\n    // 首次加载 + 每 3 秒自动刷新\r\n    this.loadMessages()\r\n    if (this.autoRefresh) {\r\n    this.timer = setInterval(this.loadMessages, 6000)\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    // 页面离开时清理定时器\r\n    clearInterval(this.timer)\r\n  },\r\n  methods: {\r\n    logout() {\r\n      localStorage.removeItem('token')\r\n      localStorage.removeItem('user')\r\n      this.$router.replace('/login')\r\n    },\r\n    // 手动/自动刷新消息列表\r\n    loadMessages() {\r\n      fetchMessages()\r\n        .then(res => {\r\n          if (res.data.code === 0) {\r\n            this.messages = res.data.data\r\n            // 滚动到底\r\n            this.$nextTick(() => {\r\n              const box = this.$refs.msgBox\r\n              box && (box.scrollTop = box.scrollHeight)\r\n            })\r\n          }\r\n        })\r\n        .catch(console.error)\r\n    },\r\n    sendMsg() {\r\n      const content = this.newMsg.trim()\r\n      if (!content) return\r\n\r\n      const payload = {\r\n        user_id: this.user.id || 1,\r\n        username: this.user.username,\r\n        content\r\n      }\r\n\r\n      sendMessage(payload)\r\n        .then(res => {\r\n          if (res.data.code === 0) {\r\n            // 发送后立即刷新\r\n            return this.loadMessages()\r\n          }\r\n          throw new Error(res.data.message)\r\n        })\r\n        .catch(console.error)\r\n        .finally(() => {\r\n          this.newMsg = ''\r\n        })\r\n    }\r\n  }\r\n}\r\n</script>","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HomePage.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HomePage.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./HomePage.vue?vue&type=template&id=633a6652\"\nimport script from \"./HomePage.vue?vue&type=script&lang=js\"\nexport * from \"./HomePage.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import axios from 'axios'\r\n\r\n// 根据后端实际地址修改\r\nconst baseURL = 'https://111dc5664cn09.vicp.fun/api';  //跑本地也用这个，因为已经映射过了\r\n// const baseURL = 'http://localhost:3000/api'         //这个纯本地\r\nconst api = axios.create({\r\n  baseURL,\r\n  timeout: 5000\r\n})\r\n\r\nexport const login = (username, password) =>\r\n  api.post('/login', { username, password })\r\n\r\n// 获取历史消息\r\nexport const fetchMessages = () => api.get('/chat/messages')\r\n\r\n// 发送消息\r\nexport const sendMessage = (payload) =>\r\n  api.post('/chat/messages', payload)"],"names":["render","_vm","this","_c","_self","staticStyle","user","avatar_url","attrs","_e","_v","_s","username","email","created_at","on","logout","loadMessages","ref","_l","messages","m","key","id","content","directives","name","rawName","value","newMsg","expression","domProps","$event","type","indexOf","_k","keyCode","sendMsg","apply","arguments","target","composing","staticRenderFns","data","JSON","parse","localStorage","getItem","timer","autoRefresh","created","setInterval","beforeDestroy","clearInterval","methods","removeItem","$router","replace","fetchMessages","then","res","code","$nextTick","box","$refs","msgBox","scrollTop","scrollHeight","catch","console","error","trim","payload","user_id","sendMessage","Error","message","finally","component","baseURL","api","axios","create","timeout","login","password","post","get"],"sourceRoot":""}